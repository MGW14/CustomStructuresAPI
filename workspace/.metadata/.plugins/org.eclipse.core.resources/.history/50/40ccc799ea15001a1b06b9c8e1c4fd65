package work.mgnet.customstructuresapi.listener;

import java.util.Random;

import org.bukkit.Material;
import org.bukkit.World;
import org.bukkit.block.Block;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.world.ChunkLoadEvent;

import work.mgnet.customstructuresapi.CustomStructuresAPI;
import work.mgnet.customstructuresapi.todo.StructureSpawner;

public class ChunkListener implements Listener {
	
	@EventHandler
	public void onChunkGeneration(ChunkLoadEvent e) {
		if (e.isNewChunk()) {
			if (new Random().nextInt(50) == 1) {
				World w = e.getChunk().getWorld();
				Block b = e.getChunk().getBlock(0, 5, 0);
				boolean foundLand = false;
				Block bb = e.getChunk().getBlock(0, w.getHighestBlockYAt(b.getX(), b.getZ()), 0);
				int trys = 0;
				while (!foundLand){
					if(trys >= 20) return;
					if(bb.getType() != Material.AIR){
						foundLand = true;
					}
					else{
						bb = bb.getLocation().subtract(0, 1, 0).getBlock();
					}
					trys++;
				}
				
				StructureSpawner.spawn(CustomStructuresAPI.structureManager.random(), bb, e.getChunk());
				
			}
		}
	}
	
}
